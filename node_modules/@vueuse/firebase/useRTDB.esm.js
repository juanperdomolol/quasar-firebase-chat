import { ref } from 'vue-demi';
import { tryOnUnmounted } from '@vueuse/shared';

/**
 * Reactive Firebase Realtime Database binding.
 *
 * @param docRef
 * @param options
 */
function useRTDB(docRef, options = {}) {
    const { autoDispose = true, } = options;
    const data = ref(undefined);
    function update(snapshot) {
        data.value = snapshot.val();
    }
    docRef.on('value', update);
    if (autoDispose) {
        tryOnUnmounted(() => {
            docRef.off('value', update);
        });
    }
    return data;
}

export { useRTDB };
